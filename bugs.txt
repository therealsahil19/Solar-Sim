EASY

Description
A new THREE.Vector2 is created every frame inside update() for copyTextureToTexture, contributing to GC load.

Location
src/trails.ts:293

Rationale
Easy to fix by creating a reused THREE.Vector2 instance as a class member or reusing a temporary vector. This avoids allocation on every frame.

Code context
        // Upload texture row using copyTextureToTexture mechanism
        this.rowTexture.needsUpdate = true;
        renderer.copyTextureToTexture(new THREE.Vector2(0, this.globalHead), this.rowTexture, this.historyTexture);
    }

Description
new THREE.Frustum() and new THREE.Matrix4() are created inside the update() loop every frame, causing unnecessary garbage collection pressure.

Location
src/managers/LabelManager.ts:123

Rationale
Easy to fix by moving frustum and projScreenMatrix to class properties and reusing them. This avoids per-frame allocation.

Code context
        // 1. Create Frustum for culling
        const frustum = new THREE.Frustum();
        const projScreenMatrix = new THREE.Matrix4();
        projScreenMatrix.multiplyMatrices(this.camera.projectionMatrix, this.camera.matrixWorldInverse);
        frustum.setFromProjectionMatrix(projScreenMatrix);

Description
The `download_textures.py` script uses `urllib.request.urlopen` without a timeout, which can cause the script to hang indefinitely if the remote server is unresponsive.

Location
download_textures.py:63

Rationale
Adding a timeout parameter is a standard practice and a simple, low-risk change to prevent hangs.

Code context
    try:
        # Verify SSL certificates properly using reused context
        with urllib.request.urlopen(url, context=context) as response:
            content = response.read()
            
            # Verify SHA-256

Description
The `package.json` file specifies versions for `jsdom` (`^27.4.0`) and `@playwright/test` (`^1.57.0`) that appear to be non-existent or futuristic, potentially indicating a typo or supply chain risk.

Location
package.json:37

Rationale
Correcting dependency versions is straightforward and essential for reproducible and secure builds.

Code context
  "devDependencies": {
    "@playwright/test": "^1.57.0",
    "@types/three": "^0.160.0",
    "jsdom": "^27.4.0",
    "typescript": "^5.3.0",

Description
The application exposes the main `THREE.Scene` and other core objects on the `window` object, increasing the attack surface for potential XSS exploits.

Location
src/main.ts:164

Rationale
Removing global assignments or wrapping them in a debug flag is a simple change that reduces attack surface.

Code context
    labelRenderer = sceneManager.labelRenderer; // Ensure labelRenderer is typed in SceneManager

    window.scene = scene;

    // Cancel any existing animation loop

Description
Physics constants like `AU_SCALE` are hardcoded in `debris.ts` shader strings, duplicating values from `physics.ts`.

Location
src/debris.ts:100

Rationale
Can be fixed by importing constants and interpolating them into the shader string or using uniforms.

Code context
const DEBRIS_SHADER_HEAD = `
#define AU_SCALE 40.0
#define LIMIT_1 30.0
#define LIMIT_2 50.0
#define VISUAL_LIMIT_1 1200.0
#define LOG_FACTOR_K 1.5
#define VISUAL_LIMIT_2 1382.67
#define LOG_FACTOR_O 4.0
#ifndef PI
#define PI 3.14159265359
#endif

Description
Usage of `@ts-ignore` to set a non-nullable static property to null for testing purposes.

Location
src/managers/ToastManager.ts:41

Rationale
Should be replaced with a type assertion or `any` cast to maintain type safety elsewhere.

Code context
    /**
     * Resets the singleton instance.
     * @internal For testing purposes only.
     */
    public static resetInstance(): void {
        // @ts-ignore
        ToastManager.instance = null;
    }

    /**

Description
GLSL shader code is hardcoded as strings within TypeScript files, making it harder to read and lint.

Location
src/shaders.ts:1

Rationale
Moving shaders to separate .glsl files or using a tagged template literal library would improve maintainability.

Code context
export const TRAIL_VERTEX_SHADER = `
uniform sampler2D uHistory;
uniform float uHead; // Current global head index
uniform float uPointsPerTrail;
uniform float uMaxTrails;

attribute float aSegmentIndex;
attribute float aVertexIndex; // 0 = start of segment, 1 = end of segment
attribute float aTrailIndex;
attribute vec3 aColor;

Description
The `index` property in `InstanceData` interface is redundant as it matches the array index in usage.

Location
src/instancing.ts:16

Rationale
Can be removed to simplify the data structure without affecting logic.

Code context
/**
 * Individual instance data.
 */
interface InstanceData {
    /** The pivot Object3D that determines position/rotation */
    pivot: THREE.Object3D;
    /** Index in the instanced mesh */
    index: number;
    /** Whether the instance is dynamic (moves every frame) */
    dynamic: boolean;
}

Description
Commented-out code `// window.scene = this.scene;` should be removed.

Location
src/managers/SceneManager.ts:18

Rationale
Trivial removal.

Code context
    constructor() {
        // Setup Three.js Components
        this.scene = new THREE.Scene();
        // window.scene = this.scene; // Side effect, maybe avoid or make explicit

        this.scene.matrixWorldAutoUpdate = false;

        this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100000);
        this.camera.position.set(0, 60, 100);

Description
Several blocks of code are commented out in `src/main.ts` and should be removed.

Location
src/main.ts:287

Rationale
Trivial removal of commented-out logic.

Code context
                interactionTargets.push(...systemNode.interactables);
                animatedObjects.push(...systemNode.animated);
                allOrbits.push(...systemNode.orbits);
                allTrails.push(...systemNode.trails);
                systemNode.labels.forEach(l => labelManager?.add(l));
                // allLabels.push(...systemNode.labels);

                if (systemNode.animated.length > 0) {
                    const primary = systemNode.animated[0];
                    if (primary?.pivot) planets.push(primary.pivot);

Description
injectSkeletons does not have explicit tests for edge cases like count <= 0 or empty/null containers.

Location
src/utils/SkeletonUtils.ts:14

Rationale
Robust utility functions should handle edge cases gracefully. Adding tests for count=0 or invalid inputs improves reliability.

Code context
export function injectSkeletons(
    container: HTMLElement,
    count: number = 3,
    styles: Partial<CSSStyleDeclaration> = {},
    className: string = '',
    clear: boolean = true
): void {

Description
The exported utility `updateNormalizedCoordinates` converts client coordinates to NDC but has no unit test.

Location
src/input.ts:53

Rationale
This is a pure function that is critical for raycasting accuracy. Writing a unit test is trivial and ensures correctness.

Code context
export function updateNormalizedCoordinates(
    target: THREE.Vector2,
    clientX: number,
    clientY: number,
    width: number,
    height: number
): void {

MEDIUM
Description
When clicking an instance in an InstancedMesh, the selection logic uses the mesh's userData instead of the specific instance's userData.

Location
src/input.ts:396

Rationale
Requires modifying `processHit` to retrieve the correct instance data and pass it to `handleSelection`.

Code context
    const processHit = (hit: THREE.Intersection) => {
        if (!hit) return;

        let mesh: THREE.Object3D = hit.object;
        let userData = mesh.userData;

        // Handle InstancedMesh
        if ((mesh as THREE.InstancedMesh).isInstancedMesh && context.instanceRegistry) {
            const data = context.instanceRegistry.getIntersectionData(
                mesh as THREE.InstancedMesh,

Description
The `init` function in `main.ts` is overly complex (> 250 lines), mixing initialization, state management, and the animation loop.

Location
src/main.ts:143

Rationale
Requires careful extraction of logic into separate functions or modules to avoid breaking closure dependencies.

Code context
const LAZY_LOAD_DELAY = 2000;


/**
 * Initializes the application.
 */
export async function init(): Promise<void> {
    // Reset Global State
    interactionTargets.length = 0;
    animatedObjects.length = 0;

Description
The module `benchmark.ts` attaches properties to the global `window` object upon import.

Location
src/benchmark.ts:131

Rationale
Initialization logic should be encapsulated in an exported function to be called explicitly.

Code context
    };
}

// Auto-expose to window for console access
if (typeof window !== 'undefined') {
    window.boltBenchmark = startBenchmark;
    console.log('%câš¡ Bolt Benchmark loaded. Run boltBenchmark() in console.', 'color: #ffc107;');
}

Description
SettingsPanel lacks a dedicated unit test suite to verify its logic, event handling, and DOM interactions in isolation.

Location
src/components/SettingsPanel.ts:44

Rationale
UI components often break. Unit tests are faster and more reliable than E2E for verifying specific logic paths like callbacks and state updates.

Code context
export class SettingsPanel implements Disposable {
    private callbacks: SettingsPanelCallbacks;
    private settingsManager: SettingsManager;
    private _isOpen: boolean = false;
    private dom: SettingsPanelDOM;


Description
The `toggle` method updates the internal state and visibility of all labels. A test should verify that subsequent updates respect this state.

Location
src/managers/LabelManager.ts:78

Rationale
Label visibility logic is complex and relies on correct state management. A targeted test for `toggle` ensures UI controls work as expected.

Code context
    public toggle(show: boolean): void {
        this.showLabels = show;
        this.needsUpdate = true;
        this.labels.forEach(label => {
            label.visible = this.showLabels;
        });
    }

Description
The main entry point `init()` and `dispose()` functions orchestrate the application lifecycle but lack unit/integration tests.

Location
src/main.ts:142

Rationale
This is the application entry point. While complex due to global state, verifying that `init` completes without error and `dispose` cleans up resources is high value.

Code context
export async function init(): Promise<void> {
    // Reset Global State
    interactionTargets.length = 0;
    animatedObjects.length = 0;
    planets.length = 0;
    allOrbits.length = 0;
    allTrails.length = 0;




